function toJSON(model) {
  model = model || {};
  return model.toJSON ? model.toJSON() : null;
}

function UserFinder() {}

UserFinder.prototype.setUserStore = function (userStore) {
  this._userStore = userStore;
}

UserFinder.prototype.authenticate = function (uid, providerId, done) {
  if (!uid || !providerId) { return done(null, null); }

  var opts = {
    uid: uid,
    provider_id: providerId
  };

  this._userStore
    .fetch(opts)
    .then(toJSON)
    .exec(done);
};

UserFinder.prototype.findById = function (id, done) {
  if (!id) { return done(null, null); }

  this._userStore
    .set({ user_id: id })
    .fetch()
    .then(toJSON)
    .exec(done);
}

module.exports = function userFinder(options) {
  var finder = new UserFinder();

  finder.setUserStore(options.userStore);

  return finder;
};
