var cpuCount = require('os').cpus().length;

function repeat(func, times) {
  var i;

  for (i = 0; i < times; i++) {
    func();
  }
}

function fork(cluster, workerCount) {
  var forkWorker = function () {
    cluster.fork();
  };

  repeat(forkWorker, workerCount || cpuCount);
  cluster.on('disconnect', forkWorker);
}

module.exports = fork;
