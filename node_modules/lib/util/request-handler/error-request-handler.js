var BaseRequestHandler = require('./base-request-handler');

function ErrorRequestHandler() {
  BaseRequestHandler.apply(this, arguments);
}

ErrorRequestHandler.prototype = Object.create(BaseRequestHandler.prototype, {
  constructor: { value: ErrorRequestHandler }
});

ErrorRequestHandler.prototype.setRoute = function (error) {
  this._route = error;
}

ErrorRequestHandler.prototype.execute = function () {
  this._createViewStream();
  this._coupleStreams(this._concatStreams());
  this._emitStreamError();
};

ErrorRequestHandler.prototype._concatStreams = function () {
  return [ this._viewStream, this._response ];
};

ErrorRequestHandler.prototype._emitStreamError = function () {
  this._viewStream.emit('streamError', this._route);
};

ErrorRequestHandler.create = function (opts) {
  opts = opts || {};

  var handler = new ErrorRequestHandler();

  handler.setRequest(opts.request);
  handler.setResponse(opts.response);
  handler.setErrorHandler(opts.errorHandler);
  handler.setRoute(opts.route);

  return handler;
};

module.exports = ErrorRequestHandler;
